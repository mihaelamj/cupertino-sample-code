<?xml version="1.0" encoding="UTF-8" ?>
<!--
 See LICENSE folder for this sampleâ€™s licensing information.
 
 Abstract:
 This instrpkg file defines the schemas, modelers, and instruments for modeling Mobile Agent
 execution and transition intervals.
 
 -->
<package>
    <id>com.apple.mobileagents.MobileAgentsExecutionAndTransition</id>
    <title>Mobile Agents Execution And Transition</title>
    <owner>
        <name>Apple Inc.</name>
    </owner>

    <import-schema>os-signpost</import-schema>
    
    <!-- This custom instruent will track Mobile Agent transitions in addition to their
         execution at stops. The interval-schema defined in MobileAgentsExecution.instrpkg
         already contains all of the columns necessary to support this. A transition is
         also an interval defined by a start time and a duration executed by an agent that
         wants to arrive at another stop. Thus, the mobile-agent-execution schema in
         MobileAgentsExecution.instrpkg can be reused. The name is changed in this file
         to better reflect what the schema is modeling. Specifically, instead of just
         tracking Mobile Agent execution intervals, the schema now tracks overall agent
         activity.
     
    -->
    
    <interval-schema>
        <id>mobile-agent-activity</id>
        <title>Mobile Agent Activity</title>
        
        <start-column>
            <mnemonic>start</mnemonic>
            <title>Start</title>
            <type>start-time</type>
        </start-column>
        
        <duration-column>
            <mnemonic>duration</mnemonic>
            <title>Duration</title>
            <type>duration</type>
        </duration-column>
        
        <primary-column>
            <mnemonic>agent-kind</mnemonic>
            <title>Agent Kind</title>
            <type>string</type>
        </primary-column>
        
        <column>
            <mnemonic>agent-kind-code</mnemonic>
            <title>Agent Kind Code</title>
            <type>uint64</type>
        </column>
        
        <column>
            <mnemonic>state</mnemonic>
            <title>State</title>
            <type>state</type>
        </column>
        
        <column>
            <mnemonic>instance</mnemonic>
            <title>Instance</title>
            <type>address</type>
        </column>
        
        <column>
            <mnemonic>stop-kind</mnemonic>
            <title>Stop Kind</title>
            <type>string</type>
        </column>
        
        <column>
            <mnemonic>activity</mnemonic>
            <title>Activity</title>
            <type>formatted-label</type>
        </column>
        
        <column>
            <mnemonic>activity-type</mnemonic>
            <title>Activity Type</title>
            <type>event-concept</type>
        </column>
        
    </interval-schema>
    
    <modeler>
        <id>com.apple.mobileagents.execution.transition.modeler</id>
        <title>Mobile Agent Execution and Transition Modeler</title>
        <purpose>Transforms mobile agent signposts into meaningful execution and transition data</purpose>
        
        <production-system>
            <rule-path>mobile-agent-kind-knowledge.clp</rule-path>
            <rule-path>mobile-agent-execution-concepts.clp</rule-path>
            <rule-path>mobile-agent-transition-concepts.clp</rule-path>
            <rule-path>mobile-agent-parking-concepts.clp</rule-path>
            <rule-path>mobile-agent-kind-code-resolution.clp</rule-path>
            <rule-path>mobile-agent-modeling.clp</rule-path>
            <rule-path>mobile-agent-recording.clp</rule-path>
        </production-system>
        
        <output>
            <schema-ref>mobile-agent-activity</schema-ref>
            <required-input>
                <schema-ref>os-signpost</schema-ref>
                <attribute>
                    <name>category</name>
                    <string>Mobile Agent</string>
                </attribute>
                <attribute>
                    <name>subsystem</name>
                    <string>com.apple.dt.utilities</string>
                </attribute>
            </required-input>
        </output>
        
        
    </modeler>
    
    <instrument>
        <id>com.apple.dt.mobile-agents</id>
        <title>Mobile Agent Activity</title>
        <category>Behavior</category>
        <purpose>Tracks the execution and movement of mobile agents.</purpose>
        <icon>Generic</icon>
        
        <create-table>
            <id>activity-table</id>
            <schema-ref>mobile-agent-activity</schema-ref>
        </create-table>
        
        
        <graph>
            <title>Execution</title>
            <lane>
                <title>Agents</title>
                <table-ref>activity-table</table-ref>
                <plot>
                    <value-from>state</value-from>
                    <label-from>activity</label-from>
                </plot>
            </lane>
        </graph>
        
        <list>
            <title>Execution</title>
            <table-ref>activity-table</table-ref>
            <column>start</column>
            <column>duration</column>
            <column>agent-kind</column>
            <column>stop-kind</column>
            <column>state</column>
            <column>activity</column>
        </list>
    </instrument>
    
</package>
